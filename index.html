<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="collections.css">
	<title>Collections</title>
</head>


	

<body>
	
	<a href="https://empt1dae.github.io/optimize/" onclick="countRedirect(event)">
    <img src="4x.png" alt="–ë–∞–Ω–Ω–µ—Ä">
</a>

<script type="module">
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import { getFirestore, doc, setDoc, updateDoc, getDoc, increment } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-analytics.js";

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDX4WrSs8_7eamobot9Rq38-cig-vXIZyU",
        authDomain: "optimize-adf64.firebaseapp.com",
        projectId: "optimize-adf64",
        storageBucket: "optimize-adf64.firebasestorage.app",
        messagingSenderId: "320149610678",
        appId: "1:320149610678:web:a13c9aaad88592e0094617",
        measurementId: "G-BC2TNFRW0Q"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);  // –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    const db = getFirestore(app); // –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Firestore

    // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞
    window.countRedirect = async function(event) {
        event.preventDefault(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥

        const targetUrl = event.currentTarget.href;  // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É
        const counterRef = doc(db, "analytics", "click_counter");  // –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç

        try {
            const docSnap = await getDoc(counterRef);  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            if (docSnap.exists()) {
                // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                await updateDoc(counterRef, { count: increment(1) });
                console.log("‚úÖ Firestore: –°—á—ë—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!");
            } else {
                // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –µ–≥–æ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
                await setDoc(counterRef, { count: 1 });
                console.log("üî• Firestore: –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å—á—ë—Ç—á–∏–∫!");
            }
        } catch (error) {
            console.error("‚ùå –û—à–∏–±–∫–∞ Firestore:", error);
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –≤ Firestore
        setTimeout(() => {
            window.location.href = targetUrl;
        }, 500);  // –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 500 –º—Å, —á—Ç–æ–±—ã —É—Å–ø–µ–ª –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —Å—á—ë—Ç—á–∏–∫
    };
</script>

</body>

</html>
